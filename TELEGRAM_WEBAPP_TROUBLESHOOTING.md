# Telegram Web App - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

## üîß –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (`webapp_server.py`)
- Ngrok —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –Ω—É–ª–∏

**–ü—Ä–∏—á–∏–Ω–∞:**
–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∞–π–ª `data/dashboard_state.json`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è API `/api/dashboard`

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `data/dashboard_state.json` —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è

---

### –ü—Ä–æ–±–ª–µ–º–∞ #2: Telegram –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω—É–ª–∏ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ

**–°–∏–º–ø—Ç–æ–º—ã:**
```
üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê
üî¢ –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: 0
üìà Win Rate: 0.0%
üíπ Profit Factor: 0.00
üìâ Sharpe Ratio: 0.00
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–í —Ñ—É–Ω–∫—Ü–∏–∏ `handle_menu_stats()` –≤ `infra/telegram_bot.py` –Ω–µ –∏–∑–≤–ª–µ–∫–∞–ª–∏—Å—å –º–µ—Ç—Ä–∏–∫–∏ `profit_factor` –∏ `sharpe_ratio` –∏–∑ `portfolio_tracker.get_stats()`

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–¥ –≤ `infra/telegram_bot.py:309-311`:
```python
# FIXED: –î–æ–±–∞–≤–ª–µ–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ profit_factor –∏ sharpe_ratio
stats_data['profit_factor'] = stats.get('profit_factor', 0.0)
stats_data['sharpe_ratio'] = stats.get('sharpe_ratio', 0.0)
```

---

## üìù –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### 1. –¢–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ

–ö–æ–≥–¥–∞ –∑–∞–ø—É—â–µ–Ω —Ç–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç (`runner/live.py`), –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç `data/dashboard_state.json` —á–µ—Ä–µ–∑ `DashboardStateManager`:

```python
# –í runner/live.py:2242-2244
if self.dashboard_state_manager:
    self.dashboard_state_manager.save_state(self)
```

### 2. –í–µ–±-—Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

Flask —Å–µ—Ä–≤–µ—Ä (`webapp_server.py`) —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª –∏ –æ—Ç–¥–∞–µ—Ç —á–µ—Ä–µ–∑ API:

```python
@app.route('/api/dashboard')
def get_dashboard():
    file_data = load_dashboard_data_from_file()  # –ß–∏—Ç–∞–µ—Ç dashboard_state.json
    return jsonify(dashboard_data)
```

### 3. Web App –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`telegram_webapp/dashboard.html`) –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `fetch('/api/dashboard')`

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç A: –° –∑–∞–ø—É—â–µ–Ω–Ω—ã–º —Ç–æ—Ä–≥–æ–≤—ã–º –±–æ—Ç–æ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç:**
   ```bash
   python runner/live.py
   ```
   –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å `data/dashboard_state.json`

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä:**
   ```bash
   python webapp_server.py
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok:**
   ```bash
   ngrok http 8080
   ```

4. **–û—Ç–∫—Ä–æ–π—Ç–µ Web App –≤ Telegram**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok URL –≤ Telegram –±–æ—Ç–µ

### –í–∞—Ä–∏–∞–Ω—Ç B: –ë–µ–∑ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

1. **–°–æ–∑–¥–∞–π—Ç–µ/–æ–±–Ω–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é:**
   ```bash
   python update_dashboard_data.py
   ```
   –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç `data/dashboard_state.json` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

2. **–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é:**
   ```json
   {
     "balance": 1875.02,
     "equity": 1875.02,
     "totalPnl": 39.03,
     "roiPct": 2.13,
     "openPositions": 0,
     "totalTrades": 0,
     "winRate": 0.0,
     "profitFactor": 0.0,
     "positions": [],
     "equityHistory": {
       "labels": ["10:00", "11:00", "12:00"],
       "values": [1836.0, 1850.0, 1875.02]
     },
     "lastUpdate": "2025-11-17T16:18:22.000000"
   }
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ ngrok** (–∫–∞–∫ –≤ –≤–∞—Ä–∏–∞–Ω—Ç–µ A)

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä:

```bash
curl http://localhost:8080/api/dashboard
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–∞—à–±–æ—Ä–¥–∞.

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª –¥–∞–Ω–Ω—ã—Ö:

```bash
cat data/dashboard_state.json
```

–ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç –∏–ª–∏ –æ–Ω –ø—É—Å—Ç–æ–π - –∑–∞–ø—É—Å—Ç–∏—Ç–µ `update_dashboard_data.py`

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞:

–ï—Å–ª–∏ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `DashboardStateManager` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω:
```
‚úÖ DashboardStateManager initialized
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –±–æ—Ç–∞:

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:
- `/menu` - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/stats` - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- `/status` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö dashboard_state.json

```json
{
  "balance": 1875.02,           // –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
  "equity": 1875.02,            // Equity (–±–∞–ª–∞–Ω—Å + unrealized P&L)
  "totalPnl": 39.03,            // –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫
  "roiPct": 2.13,               // ROI –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
  "openPositions": 0,           // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
  "totalTrades": 0,             // –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫
  "winRate": 0.0,               // –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–∏–≥—Ä—ã—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ (0.0-1.0)
  "profitFactor": 0.0,          // Profit factor
  "positions": [],              // –ú–∞—Å—Å–∏–≤ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
  "equityHistory": {
    "labels": [],               // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    "values": []                // –ó–Ω–∞—á–µ–Ω–∏—è equity
  },
  "sharpeRatio": 0.88,          // Sharpe Ratio (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  "maxDrawdown": 201.48,        // Max drawdown –≤ USD (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  "maxDrawdownPct": 9.89,       // Max drawdown –≤ % (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  "lastUpdate": "2025-11-17..." // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] –§–∞–π–ª `data/dashboard_state.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] –í–µ–±-—Å–µ—Ä–≤–µ—Ä `webapp_server.py` –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080
- [ ] Ngrok –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Forwarding URL
- [ ] Telegram –±–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º Web App URL
- [ ] API `/api/dashboard` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ curl –∑–∞–ø—Ä–æ—Å–µ

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –î–∞–Ω–Ω—ã–µ –≤ Telegram –±–æ—Ç–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ `portfolio_tracker` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ—Ä–≥–æ–≤—ã–π –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `portfolio_tracker` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ –±–æ—Ç–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### 2. Web App –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç demo –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∏—á–∏–Ω–∞:** API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `webapp_server.py` –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ngrok Forwarding URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `data/dashboard_state.json`

### 3. "Using demo data" –≤ Web App

**–ü—Ä–∏—á–∏–Ω–∞:** Fallback –Ω–∞ mock –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –û—Ç–∫—Ä–æ–π—Ç–µ DevTools –≤ –±—Ä–∞—É–∑–µ—Ä–µ/Telegram
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Console –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ fetch
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ ngrok URL

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `data/dashboard_state.json`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ngrok Forwarding URL

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **infra/telegram_bot.py** (—Å—Ç—Ä–æ–∫–∏ 309-311)
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ `profit_factor` –∏ `sharpe_ratio`

2. **data/dashboard_state.json** (—Å–æ–∑–¥–∞–Ω)
   - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—è

3. **update_dashboard_data.py** (—Å–æ–∑–¥–∞–Ω)
   - –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è dashboard –¥–∞–Ω–Ω—ã—Ö

### –í—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å! ‚úÖ

–¢–µ–ø–µ—Ä—å:
- ‚úÖ Telegram –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ Web App –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ API `/api/dashboard` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–º —Ç–æ—Ä–≥–æ–≤–æ–º –±–æ—Ç–µ
